<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Дашборд | SkillExam</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>
<body>

    <header class="header-nav" style="padding-bottom: 8px; padding-top: 8px;">
        <a href="/" class="logo">SkillExam</a>
        <nav class="nav-links">
            {% if current_user.is_authenticated %}
                <div class="user-dropdown">
                    <button class="user-menu-btn">
                        <div class="user-avatar">
                            {{ current_user.full_name.split()[0][0] if current_user.full_name else 'U' }}
                        </div>
                        <div class="user-details" style="text-align: right;">
                            <div class="user-name">{{ current_user.full_name }}</div>
                            <div class="role-badge">
                                {% if current_user.role == 'admin' %}Администратор
                                {% elif current_user.role == 'hr' %}HR
                                {% elif current_user.role == 'manager' %}Руководитель
                                {% elif current_user.role == 'employee' %}Сотрудник
                                {% endif %}
                            </div>
                        </div>
                        <i class="fas fa-chevron-down" style="margin-left: 0.5rem;"></i>
                    </button>
                    <div class="dropdown-menu" id="userDropdown">
                        <a href="{{ url_for('main.logout') }}" class="dropdown-item logout" style="margin-left: 0px;">
                            <i class="fas fa-sign-out-alt"></i> Выйти
                        </a>
                    </div>
                </div>   
            {% endif %}
        </nav>
    </header>

    <main style="padding: 2rem; max-width: 1200px; margin: 0 auto;">
        <h1>Добро пожаловать в SkillExam, {{ current_user.full_name if current_user.is_authenticated else 'Гость' }}!</h1>
        <p>Вы успешно вошли в систему.</p>
        
        <div class="user-management-panel" style="margin-top: 2rem;">
            {% if current_user.is_authenticated %}                                
                {% if current_user.role == 'hr' %}
                <div class="hr-buttons" style="display: flex; gap: 1rem; flex-wrap: wrap;">
                    <button class="open-add-user-modal btn btn-success"
                            data-role="hr"
                            style="padding: 0.75rem 1.5rem; background-color: #28a745; color: white; text-decoration: none; border-radius: 5px; border: none; cursor: pointer;">
                        <i class="fas fa-user-plus"></i> Добавить пользователя
                    </button>
                </div>
                
                {% elif current_user.role == 'manager' %}
                <div class="manager-buttons">
                    <button class="open-add-user-modal btn btn-success"
                            data-role="manager"
                            data-department-id="{{ current_user.department_id }}"
                            data-department-name="{{ current_user.department.name if current_user.department else 'Не назначен' }}"
                            style="padding: 0.75rem 1.5rem; background-color: #28a745; color: white; text-decoration: none; border-radius: 5px; border: none; cursor: pointer;">
                        <i class="fas fa-user-plus"></i> Добавить сотрудника
                    </button>
                </div>
                {% endif %}
            {% endif %}
        </div>
    </main>

    <div id="logoutConfirmationModal" class="modal-adduser"> 
        <div class="modal-adduser-content">
            <div class="modal-adduser-header">
                <h4 id="logoutModalTitle">Вы уверены, что хотите выйти из системы?</h2>
                <button class="modal-adduser-close" id="closeLogoutModal">&times;</button>
            </div>
            <div class="modal-adduser-footer">
                <button id="cancelLogoutBtn" class="btn btn-secondary">Отмена</button>
                <button id="confirmLogoutBtn" class="btn btn-primary btn-danger">Выйти</button>
            </div>
        </div>
    </div>

    <div id="addUserModal" class="modal-adduser">
        <div class="modal-adduser-content">
            <div class="modal-adduser-header">
                <h2 id="modaladduserTitle">Добавить пользователя</h2>
                <button class="modal-adduser-close" id="closeadduserModal">&times;</button>
            </div>
            <div class="modal-adduser-body">
                <div class="form-notice" id="formNotice">
                </div>
                
                <form id="addUserForm">
                    <div class="form-field">
                        <label for="full_name">Полное имя *</label>
                        <input type="text" id="full_name" name="full_name" required>
                        <div class="error-message" id="full_name_error"></div>
                    </div>
                    
                    <div class="form-field">
                        <label for="login">Логин *</label>
                        <input type="text" id="login" name="login" required>
                        <div class="error-message" id="login_error"></div>
                    </div>
                    
                    <div class="form-field">
                        <label for="password">Пароль *</label>
                        <input type="password" id="password" name="password" required>
                        <div class="error-message" id="password_error"></div>
                    </div>
                    
                    <div class="form-field">
                        <label for="role">Роль *</label>
                        <select id="role" name="role" required>
                            <option value="">Выберите роль</option>
                            <option value="employee">Сотрудник</option>
                            <option value="manager">Руководитель</option>
                            <option value="hr">HR</option>
                        </select>
                        <div class="error-message" id="role_error"></div>
                    </div>
                    
                    <div class="form-field" id="departmentField">
                        <label for="department_id">Отдел *</label>
                        <select id="department_id" name="department_id" required>
                            <option value="">Выберите отдел</option>
                        </select>
                        <div class="error-message" id="department_id_error"></div>
                    </div>
                    
                    <div class="form-field" id="managerDepartmentInfo" style="display: none;">
                        <label>Отдел</label>
                        <input type="text" id="manager_department_display" class="disabled-field" disabled>
                        <div class="department-info">
                            <i class="fas fa-info-circle"></i>
                            <span>Руководитель может добавлять сотрудников только в свой отдел</span>
                        </div>
                        <input type="hidden" id="manager_department_id" name="department_id">
                    </div>
                </form>
            </div>
            <div class="modal-adduser-footer">
                <button type="button" class="btn btn-secondary" id="cancelBtn">Отмена</button>
                <button type="button" class="btn btn-primary" id="submitBtn">Добавить</button>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>

</body>
</html>