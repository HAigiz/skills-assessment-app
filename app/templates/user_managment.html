{% extends "base.html" %}

{% block title %}–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ | SkillExam{% endblock %}

{% block extra_css %}
<style>
    .score-badge {
        display: inline-block;
        padding: 0.25rem 0.75rem;
        border-radius: 20px;
        font-weight: 600;
        font-size: 0.9rem;
        margin-left: 0.5rem;
    }

    .score-1 { background: #ffebee; color: #d32f2f; }
    .score-2 { background: #fff3e0; color: #f57c00; }
    .score-3 { background: #fff8e1; color: #ffa000; }
    .score-4 { background: #e8f5e9; color: #388e3c; }
    .score-5 { background: #e3f2fd; color: #1976d2; }

    .employee-card {
        transition: transform 0.3s, box-shadow 0.3s;
    }

    .employee-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 20px rgba(0,0,0,0.1);
    }

    .btn {
        transition: all 0.3s;
    }

    .btn:hover {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-color: transparent;
    }

    .add-section {
        background: white;
        border-radius: 10px;
        padding: 1.5rem;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        margin-bottom: 2rem;
    }

    .dashboard-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 2rem;
    }
    
    .managment-header {
        margin-bottom: 2rem;
    }
    
    .managment-header h1 {
        color: #333;
        margin-bottom: 0.5rem;
    }
    
    .text-muted {
        color: #666;
    }
    
    .comparison-section {
        background: white;
        border-radius: 10px;
        padding: 1.5rem;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        margin-bottom: 2rem;
    }
    
    .form-row {
        display: flex;
        gap: 1rem;
        margin-bottom: 1.5rem;
        flex-wrap: wrap;
    }
    
    .form-group {
        flex: 1;
        min-width: 250px;
    }
    
    .form-group label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: 500;
        color: #333;
    }
    
    .form-group select,
    .form-group input {
        width: 100%;
        padding: 0.75rem;
        border: 1px solid #ddd;
        border-radius: 5px;
        font-size: 1rem;
    }
    
    .form-group select:focus,
    .form-group input:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }
    
    .btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        padding: 0.75rem 1.5rem;
        border: none;
        border-radius: 5px;
        font-size: 1rem;
        cursor: pointer;
        transition: all 0.3s;
        text-decoration: none;
    }
    
    .btn-primary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
    }
    
    .btn-primary:hover {
        opacity: 0.9;
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
    }
    
    .btn-primary:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
    }
    
    .comparison-results {
        display: none;
        margin-top: 2rem;
    }
    
    .employees-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 2rem;
        padding-bottom: 1rem;
        border-bottom: 2px solid #f0f0f0;
    }
    
    .employee-card {
        flex: 1;
        text-align: center;
        padding: 1.5rem;
        background: #f8f9fa;
        border-radius: 10px;
    }
    
    .employee-avatar {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 2rem;
        font-weight: bold;
        margin: 0 auto 1rem;
    }
    
    .employee-name {
        font-size: 1.25rem;
        font-weight: 600;
        margin-bottom: 0.5rem;
        color: #333;
    }
    
    .employee-info {
        color: #666;
        font-size: 0.9rem;
    }
    
    .skills-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 1rem;
    }
    
    .skills-table th,
    .skills-table td {
        padding: 1rem;
        text-align: left;
        border-bottom: 1px solid #eee;
    }
    
    .skills-table th {
        background: #f8f9fa;
        font-weight: 600;
        color: #333;
    }
    
    .skills-table tr:hover {
        background: #f9f9f9;
    }
    
    .skill-name {
        font-weight: 500;
        color: #333;
    }
    
    .skill-category {
        font-size: 0.85rem;
        color: #666;
        margin-top: 0.25rem;
    }
    
    .score-cell {
        text-align: center;
        font-weight: 600;
        min-width: 100px;
    }
    
    .score-badge {
        display: inline-block;
        padding: 0.25rem 0.75rem;
        border-radius: 20px;
        font-weight: 600;
        font-size: 0.9rem;
    }
    
    .score-1 { background: #ffebee; color: #d32f2f; }
    .score-2 { background: #fff3e0; color: #f57c00; }
    .score-3 { background: #fff8e1; color: #ffa000; }
    .score-4 { background: #e8f5e9; color: #388e3c; }
    .score-5 { background: #e3f2fd; color: #1976d2; }
    
    .difference-cell {
        text-align: center;
        min-width: 100px;
    }
    
    .difference-positive {
        color: #388e3c;
        font-weight: 600;
    }
    
    .difference-negative {
        color: #d32f2f;
        font-weight: 600;
    }
    
    .difference-zero {
        color: #666;
    }
    
    .no-data {
        color: #999;
        font-style: italic;
    }
    
    .chart-container {
        background: white;
        border-radius: 10px;
        padding: 1.5rem;
        margin-top: 2rem;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    
    .loading {
        text-align: center;
        padding: 3rem;
        color: #666;
    }
    
    .loading i {
        font-size: 2rem;
        margin-bottom: 1rem;
    }
    
    .empty-state {
        text-align: center;
        padding: 3rem;
        color: #666;
    }
    
    .empty-state i {
        font-size: 3rem;
        color: #ccc;
        margin-bottom: 1rem;
    }
    
    .notification {
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 1rem 1.5rem;
        border-radius: 5px;
        background: #4caf50;
        color: white;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        z-index: 10000;
        display: flex;
        align-items: center;
        gap: 1rem;
        animation: slideIn 0.3s ease;
    }
    
    .notification.error {
        background: #f44336;
    }
    
    .notification.warning {
        background: #ff9800;
    }
    
    @keyframes slideIn {
        from {
            transform: translateX(100%);
            opacity: 0;
        }
        to {
            transform: translateX(0);
            opacity: 1;
        }
    }
    
    .search-results {
        position: absolute;
        background: white;
        border: 1px solid #ddd;
        border-radius: 5px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        max-height: 300px;
        overflow-y: auto;
        z-index: 1000;
        width: 100%;
        margin-top: 0.5rem;
    }
    
    .search-result-item {
        padding: 0.75rem 1rem;
        cursor: pointer;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .search-result-item:hover {
        background: #f5f5f5;
    }
    
    .user-info {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        flex: 1;
    }
        
    .user-details {
        flex: 1;
    }
    
    .user-name {
        font-weight: 500;
        color: #333;
    }
    
    .user-meta {
        font-size: 0.85rem;
        color: #666;
    }
    
    .user-actions {
        display: flex;
        gap: 0.5rem;
    }
    
    .btn-action {
        background: none;
        border: 1px solid #ddd;
        border-radius: 3px;
        padding: 0.25rem 0.5rem;
        cursor: pointer;
        color: #666;
        transition: all 0.2s;
    }
    
    .btn-action:hover {
        background: #f5f5f5;
        color: #333;
    }
    
    .btn-action.edit-btn:hover {
        color: #1976d2;
        border-color: #1976d2;
    }
    
    .btn-action.delete-btn:hover {
        color: #d32f2f;
        border-color: #d32f2f;
    }
    
    @media (max-width: 768px) {
        .dashboard-container {
            padding: 1rem;
        }
        
        .form-row {
            flex-direction: column;
        }
        
        .employees-header {
            flex-direction: column;
            gap: 1rem;
        }
        
        .employee-card {
            width: 100%;
        }
        
        .skills-table {
            display: block;
            overflow-x: auto;
        }
    }
    
    /* –°—Ç–∏–ª–∏ –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π */
    .table-responsive {
        overflow-x: auto;
        margin-top: 1rem;
    }

    .table {
        width: 100%;
        border-collapse: collapse;
        background: white;
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        margin-top: 1rem;
    }

    .table th {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 1rem;
        text-align: left;
        font-weight: 600;
        border: none;
    }

    .table td {
        padding: 1rem;
        border-bottom: 1px solid #eee;
        vertical-align: middle;
    }

    .table-striped tbody tr:nth-child(odd) {
        background-color: #f9f9f9;
    }

    .table-striped tbody tr:hover {
        background-color: #f0f0f0;
        transition: background-color 0.2s;
    }

    .action-buttons {
        display: flex;
        gap: 0.5rem;
    }

    .btn-sm {
        padding: 0.4rem 0.6rem;
        font-size: 0.875rem;
        border-radius: 4px;
        border: none;
        cursor: pointer;
        transition: all 0.2s;
    }

    .btn-edit {
        background: #ffc107;
        color: #000;
    }

    .btn-edit:hover {
        background: #e0a800;
        transform: translateY(-1px);
    }

    .btn-delete {
        background: #dc3545;
        color: white;
    }

    .btn-delete:hover {
        background: #c82333;
        transform: translateY(-1px);
    }

    .btn-view {
        background: #17a2b8;
        color: white;
    }

    .btn-view:hover {
        background: #138496;
        transform: translateY(-1px);
    }

    .badge {
        display: inline-block;
        padding: 0.25rem 0.5rem;
        border-radius: 3px;
        font-size: 0.85rem;
        font-weight: 600;
    }
</style>
{% endblock %}

{% block content %}
<div class="dashboard-container">
    <div class="managment-header">
        <h1>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏</h1>
        <p class="text-muted">–í—ã –º–æ–∂–µ—Ç–µ –¥–æ–±–∞–≤–ª—è—Ç—å, –∏–∑–º–µ–Ω—è—Ç—å –∏ —É–¥–∞–ª—è—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π. –ò—Å–∫–∞—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –ø–æ –Ω–∞–≤—ã–∫–∞–º. –°—Ä–∞–≤–Ω–∏–≤–∞—Ç—å –¥–≤—É—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –∏ –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –∏—Ö –ø—Ä–æ—à–ª—ã–µ –æ—Ü–µ–Ω–∫–∏</p>
    </div>

    <div class="add-section">
        <h3><i class="fas fa-user-plus me-2"></i>–î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h3>
        
        <div class="form-row">
            <div class="form-group" style="flex: 1;">
                <label for="userSearch">–ü–æ–∏—Å–∫ –ø–æ –ø–æ–ª–Ω–æ–º—É –∏–º–µ–Ω–∏ –∏–ª–∏ –ª–æ–≥–∏–Ω—É</label>
                <input type="text" id="userSearch" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –∏–ª–∏ ivanov" 
                    oninput="searchUsers(this.value)">
                <div id="userSearchResults" class="search-results" style="display: none; margin-top: 20px;margin-left: 20px;"></div>
            </div>
        </div>
        <button class="btn btn-primary" onclick="showAddUserModal()" style="width: 260px; height: 50px; padding-bottom: 10px; padding-top: 10px;">
            <i class="fas fa-user-plus me-2"></i>–î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        </button>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
    <div id="addUserModal" class="modal-adduser">
        <div class="modal-adduser-content">
            <div class="modal-adduser-header">
                <h2 id="modaladduserTitle">–î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h2>
                <button class="modal-adduser-close" id="closeadduserModal">&times;</button>
            </div>
            <div class="modal-adduser-body">
                <div class="form-notice" id="formNotice"></div>
                
                <form id="addUserForm">
                    <input type="hidden" id="user_id" name="user_id" value="">
                    
                    <div class="form-field">
                        <label for="full_name">–ü–æ–ª–Ω–æ–µ –∏–º—è *</label>
                        <input type="text" id="full_name" name="full_name" required>
                        <div class="error-message" id="full_name_error"></div>
                    </div>
                    
                    <div class="form-field">
                        <label for="login">–õ–æ–≥–∏–Ω *</label>
                        <input type="text" id="login" name="login" required>
                        <div class="error-message" id="login_error"></div>
                    </div>

                    <div class="form-field">
                        <label for="email">Email</label>
                        <input type="email" id="email" name="email">
                    </div>
        
                    <div class="form-field">
                        <label for="position">–î–æ–ª–∂–Ω–æ—Å—Ç—å</label>
                        <input type="text" id="position" name="position">
                    </div>
                    
                    <div class="form-field">
                        <label for="password">–ü–∞—Ä–æ–ª—å *</label>
                        <input type="password" id="password" name="password">
                        <small class="text-muted">–û—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º, –µ—Å–ª–∏ –Ω–µ —Ö–æ—Ç–∏—Ç–µ –º–µ–Ω—è—Ç—å –ø–∞—Ä–æ–ª—å</small>
                        <div class="error-message" id="password_error"></div>
                    </div>
                    
                    <div class="form-field">
                        <label for="role">–†–æ–ª—å *</label>
                        <select id="role" name="role" required>
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ä–æ–ª—å</option>
                            <option value="employee">–°–æ—Ç—Ä—É–¥–Ω–∏–∫</option>
                            <option value="manager">–†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å</option>
                            <option value="hr">HR</option>
                            <option value="admin">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</option>
                        </select>
                        <div class="error-message" id="role_error"></div>
                    </div>
                    
                    <div class="form-field" id="departmentField">
                        <label for="department_id">–û—Ç–¥–µ–ª</label>
                        <select id="department_id" name="department_id">
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –æ—Ç–¥–µ–ª</option>
                        </select>
                        <div class="error-message" id="department_id_error"></div>
                    </div>
                </form>
            </div>
            <div class="modal-adduser-footer">
                <button type="button" class="btn btn-secondary" id="cancelBtn">–û—Ç–º–µ–Ω–∞</button>
                <button type="button" class="btn btn-primary" id="submitBtn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —É–¥–∞–ª–µ–Ω–∏—è -->
    <div id="deleteUserModal" class="modal-adduser">
        <div class="modal-adduser-content">
            <div class="modal-adduser-header">
                <h2>–£–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h2>
                <button class="modal-adduser-close" onclick="closeDeleteUserModal()">&times;</button>
            </div>
            <div class="modal-adduser-body">
                <p id="deleteUserMessage">–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è?</p>
                <p class="text-danger"><strong>–í–Ω–∏–º–∞–Ω–∏–µ:</strong> –í—Å–µ –æ—Ü–µ–Ω–∫–∏ –∏ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã –±–µ–∑ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è.</p>
            </div>
            <div class="modal-adduser-footer">
                <button type="button" class="btn btn-secondary" onclick="closeDeleteUserModal()">–û—Ç–º–µ–Ω–∞</button>
                <button type="button" class="btn btn-danger" id="confirmDeleteUserBtn">–£–¥–∞–ª–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <div class="add-section">
        <h3><i class="fas fa-search me-2"></i>–ü–æ–∏—Å–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –ø–æ –Ω–∞–≤—ã–∫—É</h3>
        <div class="form-row">
            <div class="form-group">
                <label for="skillSearch">–ù–∞–≤—ã–∫</label>
                <input type="text" id="skillSearch" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: Python, JavaScript, Communication..." 
                       list="skillSuggestions">
                <datalist id="skillSuggestions">
                    {% for category, skills in categories.items() %}
                        {% for skill in skills %}
                            <div class="skill-card" data-skill-id="{{ skill.id }}">
                                <div class="skill-header">
                                    <div class="skill-name">{{ skill.name }}</div>
                                    <div class="skill-actions">
                                        <button class="action-btn edit" onclick="editSkill({{ skill.id }})" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="action-btn delete" onclick="confirmDeleteSkill({{ skill.id }}, '{{ skill.name }}', {{ skill.assessments|length if skill.assessments else 0 }})" title="–£–¥–∞–ª–∏—Ç—å">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </div>
                                
                                {% if skill.description %}
                                <div class="skill-description">{{ skill.description }}</div>
                                {% endif %}
                                
                                <div class="skill-stats">
                                    <span>ID: {{ skill.id }}</span>
                                    <span>
                                        {% set assessment_count = skill.assessments|length if skill.assessments else 0 %}
                                        <span class="assessment-count {% if assessment_count > 0 %}has-assessments{% endif %}">
                                            {{ assessment_count }} –æ—Ü–µ–Ω–æ–∫
                                        </span>
                                    </span>
                                </div>
                            </div>
                            {% endfor %}
                    {% endfor %}
                </datalist>
            </div>
            <div class="form-group">
                <label for="minScore">–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å</label>
                <select id="minScore">
                    <option value="1">1 - –ù–∞—á–∞–ª—å–Ω—ã–π</option>
                    <option value="2">2 - –ë–∞–∑–æ–≤—ã–π</option>
                    <option value="3" selected>3 - –°—Ä–µ–¥–Ω–∏–π</option>
                    <option value="4">4 - –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π</option>
                    <option value="5">5 - –≠–∫—Å–ø–µ—Ä—Ç</option>
                </select>
            </div>
        </div>
        <button class="btn btn-primary" onclick="searchBySkill()">
            <i class="fas fa-search me-2"></i>–ù–∞–π—Ç–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
        </button>
        <button class="btn btn-primary" onclick="searchBySkill()" 
                style="background: linear-gradient(135deg, #667eea 0%, #e74c3c 100%); 
                    border: none;
                    box-shadow: 0 4px 15px rgba(231, 76, 60, 0.3);">
            <i class="fas fa-search me-2"></i>–û—á–∏—Å—Ç–∏—Ç—å
        </button>
        
        <!-- –ë–ª–æ–∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ–∏—Å–∫–∞ -->
        <div id="skillSearchResults" class="search-results-container" style="display: none; margin-top: 1.5rem;">
            <div class="search-results-header">
                <div class="search-info">
                    <h4 id="searchSkillName"></h4>
                    <p id="searchSkillInfo" class="text-muted"></p>
                </div>
            </div>
            
            <div id="skillResultsContent">
                <!-- –ó–¥–µ—Å—å –±—É–¥—É—Ç –ø–æ—è–≤–ª—è—Ç—å—Å—è –∫–∞—Ä—Ç–æ—á–∫–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ -->
            </div>
        </div>
    </div>
    
    <div class="add-section">
            <h3><i class="fas fa-users me-2"></i>–í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</h3>
            <p class="text-muted" style="margin-bottom: 1rem;">–°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å–∏—Å—Ç–µ–º—ã</p>
    
            <div class="table-responsive">
                <table class="table table-striped" id="usersTable">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>–§–ò–û</th>
                            <th>–õ–æ–≥–∏–Ω</th>
                            <th>–†–æ–ª—å</th>
                            <th>–î–æ–ª–∂–Ω–æ—Å—Ç—å</th>
                            <th>–û—Ç–¥–µ–ª</th>
                            <th>–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</th>
                            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                    </thead>
                    <tbody id="usersTableBody">
                        <!-- –î–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
                        <tr>
                            <td colspan="8" style="text-align: center; padding: 2rem;">
                                <i class="fas fa-spinner fa-spin"></i> –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    

    <!-- –ù–æ–≤–∞—è —Å–µ–∫—Ü–∏—è –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ -->
    <div class="add-section">
        <h3><i class="fas fa-users me-2"></i>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</h3>
        <p class="text-muted" style="margin-bottom: 1rem;">–°—Ä–∞–≤–Ω–∏—Ç–µ –Ω–∞–≤—ã–∫–∏ –∏ –æ—Ü–µ–Ω–∫–∏ –¥–≤—É—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –∏–∑ –æ–¥–Ω–æ–≥–æ –æ—Ç–¥–µ–ª–∞</p>
        
        <div class="form-row">
            <div class="form-group">
                <label for="department">–û—Ç–¥–µ–ª *</label>
                <select id="department" name="department" required>
                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –æ—Ç–¥–µ–ª</option>
                    <option value="backend">Backend</option>
                    <option value="frontend">Frontend</option>
                    <option value="devops">DevOps</option>
                    <option value="hr">HR</option>
                </select>
            </div>
        </div>
        
        <div class="form-row">
            <div class="form-group">
                <label for="employee1">–ü–µ—Ä–≤—ã–π —Å–æ—Ç—Ä—É–¥–Ω–∏–∫ *</label>
                <input type="text" id="employee1" placeholder="–ù–∞—á–Ω–∏—Ç–µ –≤–≤–æ–¥–∏—Ç—å –∏–º—è..." 
                    oninput="searchEmployee(1, this.value)">
                <div id="employee1Results" class="search-results" style="display: none;"></div>
                <input type="hidden" id="employee1Id" name="employee1_id">
            </div>
            
            <div class="form-group">
                <label for="employee2">–í—Ç–æ—Ä–æ–π —Å–æ—Ç—Ä—É–¥–Ω–∏–∫ *</label>
                <input type="text" id="employee2" placeholder="–ù–∞—á–Ω–∏—Ç–µ –≤–≤–æ–¥–∏—Ç—å –∏–º—è..." 
                    oninput="searchEmployee(2, this.value)">
                <div id="employee2Results" class="search-results" style="display: none;"></div>
                <input type="hidden" id="employee2Id" name="employee2_id">
            </div>
        </div>
        
        <button class="btn btn-primary" onclick="compareEmployees()" id="compareBtn">
            <i class="fas fa-chart-line me-2"></i>–°—Ä–∞–≤–Ω–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
        </button>
        
        <div class="comparison-results" id="comparisonResults">
            <div class="employees-header">
                <div class="employee-card" id="employee1Card">
                    <div class="employee-avatar" id="employee1Avatar">?</div>
                    <div class="employee-name" id="employee1Name">–ù–µ –≤—ã–±—Ä–∞–Ω</div>
                    <div class="employee-info" id="employee1Info">–í—ã–±–µ—Ä–∏—Ç–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</div>
                </div>
                
                <div style="display: flex; align-items: center; padding: 0 2rem;">
                    <i class="fas fa-exchange-alt fa-2x" style="color: #667eea;"></i>
                </div>
                
                <div class="employee-card" id="employee2Card">
                    <div class="employee-avatar" id="employee2Avatar">?</div>
                    <div class="employee-name" id="employee2Name">–ù–µ –≤—ã–±—Ä–∞–Ω</div>
                    <div class="employee-info" id="employee2Info">–í—ã–±–µ—Ä–∏—Ç–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</div>
                </div>
            </div>
            
            <div id="skillsComparison">
                <h4 style="margin-bottom: 1rem;">–°—Ä–∞–≤–Ω–µ–Ω–∏–µ –Ω–∞–≤—ã–∫–æ–≤</h4>
                
                <div id="comparisonLoading" class="loading" style="display: none;">
                    <i class="fas fa-spinner fa-spin"></i>
                    <p>–ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è...</p>
                </div>
                
                <table class="skills-table" id="skillsTable" style="display: none;">
                    <thead>
                        <tr>
                            <th>–ù–∞–≤—ã–∫</th>
                            <th id="employee1Header">–°–æ—Ç—Ä—É–¥–Ω–∏–∫ 1</th>
                            <th id="employee2Header">–°–æ—Ç—Ä—É–¥–Ω–∏–∫ 2</th>
                            <th>–†–∞–∑–Ω–∏—Ü–∞</th>
                        </tr>
                    </thead>
                    <tbody id="skillsTableBody">
                        <!-- –î–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                    </tbody>
                </table>
                
                <div id="noComparisonData" class="empty-state" style="display: none;">
                    <i class="fas fa-chart-bar"></i>
                    <h4>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è</h4>
                    <p>–£ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –Ω–µ—Ç –æ—Ü–µ–Ω–æ–∫ –Ω–∞–≤—ã–∫–æ–≤ –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è</p>
                </div>
            </div>
            
            <div class="chart-container" id="chartSection" style="display: none;">
                <h4 style="margin-bottom: 1rem;">–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è</h4>
                <div style="position: relative; height: 400px;">
                    <canvas id="comparisonChart"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
<div id="successToast" class="notification" style="display: none;">
    <i class="fas fa-check-circle"></i>
    <span id="toastMessage">–û–ø–µ—Ä–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ!</span>
</div>

<div id="errorToast" class="notification error" style="display: none;">
    <i class="fas fa-exclamation-circle"></i>
    <span id="errorToastMessage">–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞</span>
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/user_managment.js') }}"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
    let comparisonChart = null;
    let debounceTimers = {};
    let selectedDepartment = '';
    let selectedEmployees = { employee1: null, employee2: null };
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    document.addEventListener('DOMContentLoaded', function() {
        initializeComparisonPage();
        
        // –ó–∞–∫—Ä—ã—Ç–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ–∏—Å–∫–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ
        document.addEventListener('click', function(e) {
            const searchInputs = ['employee1', 'employee2'];
            searchInputs.forEach(inputId => {
                const input = document.getElementById(inputId);
                const results = document.getElementById(`${inputId}Results`);
                if (input && results && !input.contains(e.target) && !results.contains(e.target)) {
                    results.style.display = 'none';
                }
            });
        });
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ—Ç–¥–µ–ª–∞
        document.getElementById('department').addEventListener('change', function() {
            selectedDepartment = this.value;
            // –û—á–∏—â–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –ø—Ä–∏ —Å–º–µ–Ω–µ –æ—Ç–¥–µ–ª–∞
            clearSelectedEmployees();
        });
    });
    
    function initializeComparisonPage() {
        console.log('–°—Ç—Ä–∞–Ω–∏—Ü–∞ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞');
    }
    
    function searchEmployee(employeeNum, query) {
        console.log(`–ü–æ–∏—Å–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ ${employeeNum}: "${query}"`);
        if (!query || query.trim().length < 2) {
            hideSearchResults(employeeNum);
            return;
        }
        
        clearTimeout(debounceTimers[employeeNum]);
        debounceTimers[employeeNum] = setTimeout(() => {
            performEmployeeSearch(employeeNum, query.trim());
        }, 300);
    }
    
    function performEmployeeSearch(employeeNum, query) {
        console.log(`üîç –ü–æ–∏—Å–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ ${employeeNum}: "${query}"`);
        
        const resultsContainer = document.getElementById(`employee${employeeNum}Results`);
        
        if (!query || query.trim().length < 2) {
            resultsContainer.style.display = 'none';
            return;
        }
    
    const department = document.getElementById('department').value;
        console.log(`–û—Ç–¥–µ–ª: "${department}"`);
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
        resultsContainer.innerHTML = `
            <div style="padding: 10px; text-align: center; color: #666;">
                <i class="fas fa-spinner fa-spin"></i> –ü–æ–∏—Å–∫...
            </div>
        `;
        resultsContainer.style.display = 'block';
    
    // –¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å - –ø—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å endpoint
    fetch(`/hr/api/search-users?q=${encodeURIComponent(query.trim())}`)
        .then(response => {
            console.log(`Response status: ${response.status}`);
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            return response.json();
        })
        .then(data => {
            console.log('–î–∞–Ω–Ω—ã–µ —Å —Å–µ—Ä–≤–µ—Ä–∞:', data);
            
            if (data.success && data.users && data.users.length > 0) {
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∞–ª—å–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
                let html = '';
                data.users.forEach(user => {
                    const initials = getInitials(user.full_name);
                    html += `
                        <div onclick="selectEmployee(${employeeNum}, ${user.id}, '${user.full_name.replace(/'/g, "\\'")}')"
                             style="padding: 10px; border-bottom: 1px solid #eee; cursor: pointer; display: flex; align-items: center; gap: 10px;">
                            <div style="width: 40px; height: 40px; border-radius: 50%; background: #667eea; color: white; display: flex; align-items: center; justify-content: center; font-weight: bold;">
                                ${initials}
                            </div>
                            <div style="flex: 1;">
                                <div style="font-weight: 500;">${user.full_name}</div>
                                <div style="font-size: 0.85rem; color: #666;">
                                    ${user.role} ‚Ä¢ ${user.department || '–ë–µ–∑ –æ—Ç–¥–µ–ª–∞'}
                                </div>
                            </div>
                        </div>
                    `;
                });
                resultsContainer.innerHTML = html;
            } else {
                resultsContainer.innerHTML = `
                    <div style="padding: 10px; text-align: center; color: #666;">
                        <i class="fas fa-search"></i>
                        <span>${data.message || '–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã'}</span>
                    </div>
                `;
            }
        })
        .catch(error => {
            console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞:', error);
            resultsContainer.innerHTML = `
                <div style="padding: 10px; text-align: center; color: #d32f2f;">
                    <i class="fas fa-exclamation-triangle"></i>
                    <span>–û—à–∏–±–∫–∞: ${error.message}</span>
                </div>
            `;
        });
}
    
    function displaySearchResults(employeeNum, users) {
        const resultsContainer = document.getElementById(`employee${employeeNum}Results`);
    
    if (!users || users.length === 0) {
        resultsContainer.innerHTML = `
            <div class="search-result-item">
                <div class="no-results" style="padding: 1rem; text-align: center; color: #666;">
                    <i class="fas fa-search"></i>
                    <span>–°–æ–≤–ø–∞–¥–µ–Ω–∏–π –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</span>
                </div>
            </div>
        `;
        resultsContainer.style.display = 'block';
        return;
    }
    
    let html = '';
    users.forEach(user => {
        const initials = getInitials(user.full_name);
        const roleName = getRoleDisplayName(user.role);
        
        html += `
            <div class="search-result-item" onclick="selectEmployee(${employeeNum}, ${user.id}, '${user.full_name.replace(/'/g, "\\'")}', '${user.role}')"
                 style="padding: 10px; border-bottom: 1px solid #eee; cursor: pointer; display: flex; align-items: center; gap: 10px;">
                <div class="user-avatar" style="width: 40px; height: 40px; border-radius: 50%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; display: flex; align-items: center; justify-content: center; font-weight: bold;">
                    ${initials}
                </div>
                <div class="user-details" style="flex: 1;">
                    <div class="user-name" style="font-weight: 500; color: #333;">${user.full_name}</div>
                    <div class="user-meta" style="font-size: 0.85rem; color: #666;">
                        <span class="user-role">${roleName}</span>
                        ${user.position ? `<span class="user-position"> ‚Ä¢ ${user.position}</span>` : ''}
                        ${user.department ? `<span class="user-department"> ‚Ä¢ ${user.department}</span>` : ''}
                    </div>
                </div>
            </div>
        `;
    });
    
    resultsContainer.innerHTML = html;
    resultsContainer.style.display = 'block';
}
    
    function hideSearchResults(employeeNum) {
        const resultsContainer = document.getElementById(`employee${employeeNum}Results`);
        if (resultsContainer) {
            resultsContainer.style.display = 'none';
        }
    }
    
    function performEmployeeSearch(employeeNum, query) {
    if (!query || query.trim().length < 2) {
        hideSearchResults(employeeNum);
        return;
    }
    
    const department = document.getElementById('department').value;
    
    // –ï—Å–ª–∏ –æ—Ç–¥–µ–ª –Ω–µ –≤—ã–±—Ä–∞–Ω, –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º –≤—ã–±—Ä–∞—Ç—å
    if (!department) {
        const resultsContainer = document.getElementById(`employee${employeeNum}Results`);
        resultsContainer.innerHTML = `
            <div class="search-result-item">
                <div class="no-results" style="padding: 1rem; text-align: center; color: #666;">
                    <i class="fas fa-exclamation-circle"></i>
                    <span>–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –æ—Ç–¥–µ–ª</span>
                </div>
            </div>
        `;
        resultsContainer.style.display = 'block';
        return;
    }
    
    clearTimeout(debounceTimers[employeeNum]);
    debounceTimers[employeeNum] = setTimeout(() => {
        const resultsContainer = document.getElementById(`employee${employeeNum}Results`);
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
        resultsContainer.innerHTML = `
            <div class="search-result-item">
                <div class="no-results" style="padding: 1rem; text-align: center; color: #666;">
                    <i class="fas fa-spinner fa-spin"></i>
                    <span>–ü–æ–∏—Å–∫...</span>
                </div>
            </div>
        `;
        resultsContainer.style.display = 'block';
        
        // –î–µ–ª–∞–µ–º –∑–∞–ø—Ä–æ—Å –∫ —Å–µ—Ä–≤–µ—Ä—É
        fetch(`/hr/api/search-users?q=${encodeURIComponent(query.trim())}&department=${encodeURIComponent(department)}`)
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                if (data.success && data.users && data.users.length > 0) {
                    displaySearchResults(employeeNum, data.users);
                } else {
                    resultsContainer.innerHTML = `
                        <div class="search-result-item">
                            <div class="no-results" style="padding: 1rem; text-align: center; color: #666;">
                                <i class="fas fa-search"></i>
                                <span>–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</span>
                            </div>
                        </div>
                    `;
                    resultsContainer.style.display = 'block';
                }
            })
            .catch(error => {
                console.error('Error searching employees:', error);
                resultsContainer.innerHTML = `
                    <div class="search-result-item">
                        <div class="no-results" style="padding: 1rem; text-align: center; color: #666;">
                            <i class="fas fa-exclamation-triangle"></i>
                            <span>–û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å.</span>
                        </div>
                    </div>
                `;
                resultsContainer.style.display = 'block';
            });
    }, 500);
}
    function selectEmployee(employeeNum, userId, userName, userRole) {
        // –°–∫—Ä—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞
        hideSearchResults(employeeNum);
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–ª–µ –≤–≤–æ–¥–∞
        const inputField = document.getElementById(`employee${employeeNum}`);
        const hiddenField = document.getElementById(`employee${employeeNum}Id`);
        
        inputField.value = userName;
        hiddenField.value = userId;
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
        selectedEmployees[`employee${employeeNum}`] = {
            id: userId,
            name: userName,
            role: userRole
        };
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –∫–∞—Ä—Ç–æ—á–∫—É —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
        updateEmployeeCard(employeeNum, userName, userId);
        
        // –û—á–∏—â–∞–µ–º –ø–æ–ª–µ –¥—Ä—É–≥–æ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞, –µ—Å–ª–∏ –≤—ã–±—Ä–∞–ª–∏ —Ç–æ–≥–æ –∂–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
        const otherEmployeeNum = employeeNum === 1 ? 2 : 1;
        const otherInputField = document.getElementById(`employee${otherEmployeeNum}`);
        const otherHiddenField = document.getElementById(`employee${otherEmployeeNum}Id`);
        
        if (otherHiddenField.value == userId) {
            otherInputField.value = '';
            otherHiddenField.value = '';
            selectedEmployees[`employee${otherEmployeeNum}`] = null;
            updateEmployeeCard(otherEmployeeNum, '–ù–µ –≤—ã–±—Ä–∞–Ω', null);
        }
    }
    
    function updateEmployeeCard(employeeNum, userName, userId) {
        const avatarElement = document.getElementById(`employee${employeeNum}Avatar`);
        const nameElement = document.getElementById(`employee${employeeNum}Name`);
        const infoElement = document.getElementById(`employee${employeeNum}Info`);
        
        if (userId) {
            const initials = getInitials(userName);
            avatarElement.textContent = initials;
            nameElement.textContent = userName;
            
            // –ü–æ–ª—É—á–∞–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–µ
            fetch(`/hr/api/users/${userId}`)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        const role = getRoleDisplayName(data.user.role);
                        const position = data.user.position || '';
                        const department = data.user.department || '';
                        
                        let infoText = role;
                        if (position) infoText += ` ‚Ä¢ ${position}`;
                        if (department) infoText += ` ‚Ä¢ ${department}`;
                        
                        infoElement.textContent = infoText;
                    }
                })
                .catch(error => {
                    console.error('Error loading user details:', error);
                    infoElement.textContent = '–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è...';
                });
        } else {
            avatarElement.textContent = '?';
            nameElement.textContent = '–ù–µ –≤—ã–±—Ä–∞–Ω';
            infoElement.textContent = '–í—ã–±–µ—Ä–∏—Ç–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞';
        }
    }
    
    function clearSelectedEmployees() {
        // –û—á–∏—â–∞–µ–º –ø–æ–ª—è –≤–≤–æ–¥–∞
        ['employee1', 'employee2'].forEach(id => {
            const input = document.getElementById(id);
            const hidden = document.getElementById(`${id}Id`);
            if (input) input.value = '';
            if (hidden) hidden.value = '';
            
            const results = document.getElementById(`${id}Results`);
            if (results) results.style.display = 'none';
        });
        
        // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
        selectedEmployees.employee1 = null;
        selectedEmployees.employee2 = null;
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –∫–∞—Ä—Ç–æ—á–∫–∏
        updateEmployeeCard(1, '–ù–µ –≤—ã–±—Ä–∞–Ω', null);
        updateEmployeeCard(2, '–ù–µ –≤—ã–±—Ä–∞–Ω', null);
        
        // –°–∫—Ä—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
        document.getElementById('comparisonResults').style.display = 'none';
    }
    
    function compareEmployees() {
        const employee1Id = document.getElementById('employee1Id').value;
        const employee2Id = document.getElementById('employee2Id').value;
        const department = document.getElementById('department').value;
        
        // –í–∞–ª–∏–¥–∞—Ü–∏—è
        if (!department) {
            showNotification('–í—ã–±–µ—Ä–∏—Ç–µ –æ—Ç–¥–µ–ª', 'error');
            return;
        }
        
        if (!employee1Id || !employee2Id) {
            showNotification('–í—ã–±–µ—Ä–∏—Ç–µ –æ–±–æ–∏—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è', 'error');
            return;
        }
        
        if (employee1Id === employee2Id) {
            showNotification('–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–∑–Ω—ã—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è', 'error');
            return;
        }
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –∑–∞–≥—Ä—É–∑–∫–∏
        const compareBtn = document.getElementById('compareBtn');
        const originalText = compareBtn.innerHTML;
        compareBtn.disabled = true;
        compareBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ...';
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
        document.getElementById('comparisonResults').style.display = 'block';
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É —Ç–∞–±–ª–∏—Ü—ã
        document.getElementById('comparisonLoading').style.display = 'block';
        document.getElementById('skillsTable').style.display = 'none';
        document.getElementById('noComparisonData').style.display = 'none';
        document.getElementById('chartSection').style.display = 'none';
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–∫–∏ —Ç–∞–±–ª–∏—Ü—ã
        document.getElementById('employee1Header').textContent = selectedEmployees.employee1 ? selectedEmployees.employee1.name : '–°–æ—Ç—Ä—É–¥–Ω–∏–∫ 1';
        document.getElementById('employee2Header').textContent = selectedEmployees.employee2 ? selectedEmployees.employee2.name : '–°–æ—Ç—Ä—É–¥–Ω–∏–∫ 2';
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
        fetch(`/hr/compare-users?user1=${employee1Id}&user2=${employee2Id}`)
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                compareBtn.disabled = false;
                compareBtn.innerHTML = originalText;
                
                if (data.success) {
                    displayComparisonData(data);
                } else {
                    showNotification(data.message || '–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤', 'error');
                    document.getElementById('comparisonLoading').style.display = 'none';
                    document.getElementById('noComparisonData').style.display = 'block';
                }
            })
            .catch(error => {
                console.error('Error comparing employees:', error);
                compareBtn.disabled = false;
                compareBtn.innerHTML = originalText;
                showNotification('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ.', 'error');
                document.getElementById('comparisonLoading').style.display = 'none';
            });
    }
    
    function displayComparisonData(data) {
        const tableBody = document.getElementById('skillsTableBody');
        
        // –û—á–∏—â–∞–µ–º —Ç–∞–±–ª–∏—Ü—É
        tableBody.innerHTML = '';
        
        if (!data.comparison || data.comparison.length === 0) {
            document.getElementById('comparisonLoading').style.display = 'none';
            document.getElementById('noComparisonData').style.display = 'block';
            return;
        }
        
        // –°–æ—Ä—Ç–∏—Ä—É–µ–º –Ω–∞–≤—ã–∫–∏ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ –Ω–∞–∑–≤–∞–Ω–∏—é
        const sortedComparison = [...data.comparison].sort((a, b) => {
            if (a.category !== b.category) {
                return a.category.localeCompare(b.category);
            }
            return a.skill_name.localeCompare(b.skill_name);
        });
        
        let currentCategory = '';
        let rowCount = 0;
        
        sortedComparison.forEach(skill => {
            // –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏, –µ—Å–ª–∏ –æ–Ω–∞ –∏–∑–º–µ–Ω–∏–ª–∞—Å—å
            if (skill.category !== currentCategory) {
                currentCategory = skill.category;
                tableBody.innerHTML += `
                    <tr style="background: #f8f9fa;">
                        <td colspan="4" style="font-weight: 600; color: #333; padding: 0.75rem 1rem;">
                            ${skill.category}
                        </td>
                    </tr>
                `;
            }
            
            const user1Score = skill.user1_score !== null ? skill.user1_score : '‚Äî';
            const user2Score = skill.user2_score !== null ? skill.user2_score : '‚Äî';
            const difference = skill.difference;
            
            let differenceHtml = '‚Äî';
            let differenceClass = 'difference-zero';
            
            if (difference !== null) {
                if (difference > 0) {
                    differenceHtml = `<span class="difference-positive">+${difference}</span>`;
                    differenceClass = 'difference-positive';
                } else if (difference < 0) {
                    differenceHtml = `<span class="difference-negative">${difference}</span>`;
                    differenceClass = 'difference-negative';
                } else {
                    differenceHtml = '<span class="difference-zero">0</span>';
                    differenceClass = 'difference-zero';
                }
            }
            
            tableBody.innerHTML += `
                <tr>
                    <td>
                        <div class="skill-name">${skill.skill_name}</div>
                    </td>
                    <td class="score-cell">
                        ${user1Score !== '‚Äî' ? `<span class="score-badge score-${user1Score}">${user1Score}</span>` : '<span class="no-data">‚Äî</span>'}
                    </td>
                    <td class="score-cell">
                        ${user2Score !== '‚Äî' ? `<span class="score-badge score-${user2Score}">${user2Score}</span>` : '<span class="no-data">‚Äî</span>'}
                    </td>
                    <td class="difference-cell ${differenceClass}">
                        ${differenceHtml}
                    </td>
                </tr>
            `;
            
            rowCount++;
        });
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–∞–±–ª–∏—Ü—É
        document.getElementById('comparisonLoading').style.display = 'none';
        document.getElementById('skillsTable').style.display = 'table';
        
        // –°–æ–∑–¥–∞–µ–º –≥—Ä–∞—Ñ–∏–∫, –µ—Å–ª–∏ –µ—Å—Ç—å –¥–∞–Ω–Ω—ã–µ
        createComparisonChart(sortedComparison, data);
    }
    
    function createComparisonChart(skillsData, comparisonData) {
        // –§–∏–ª—å—Ç—Ä—É–µ–º –Ω–∞–≤—ã–∫–∏, —É –∫–æ—Ç–æ—Ä—ã—Ö –µ—Å—Ç—å –æ—Ü–µ–Ω–∫–∏ —É –æ–±–æ–∏—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
        const chartSkills = skillsData.filter(skill => 
            skill.user1_score !== null && skill.user2_score !== null
        );
        
        if (chartSkills.length < 3) {
            // –°–ª–∏—à–∫–æ–º –º–∞–ª–æ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞
            document.getElementById('chartSection').style.display = 'none';
            return;
        }
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–µ–∫—Ü–∏—é —Å –≥—Ä–∞—Ñ–∏–∫–æ–º
        document.getElementById('chartSection').style.display = 'block';
        
        const chartCanvas = document.getElementById('comparisonChart');
        if (!chartCanvas) return;
        
        // –£–Ω–∏—á—Ç–æ–∂–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π –≥—Ä–∞—Ñ–∏–∫
        if (comparisonChart) {
            comparisonChart.destroy();
        }
        
        const ctx = chartCanvas.getContext('2d');
        
        // –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ
        const labels = chartSkills.map(skill => skill.skill_name);
        const employee1Scores = chartSkills.map(skill => skill.user1_score);
        const employee2Scores = chartSkills.map(skill => skill.user2_score);
        
        comparisonChart = new Chart(ctx, {
            type: 'radar',
            data: {
                labels: labels,
                datasets: [
                    {
                        label: comparisonData.user1.full_name,
                        data: employee1Scores,
                        backgroundColor: 'rgba(102, 126, 234, 0.2)',
                        borderColor: 'rgba(102, 126, 234, 0.8)',
                        pointBackgroundColor: 'rgba(102, 126, 234, 1)',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: 'rgba(102, 126, 234, 1)',
                        borderWidth: 2,
                        pointRadius: 4
                    },
                    {
                        label: comparisonData.user2.full_name,
                        data: employee2Scores,
                        backgroundColor: 'rgba(118, 75, 162, 0.2)',
                        borderColor: 'rgba(118, 75, 162, 0.8)',
                        pointBackgroundColor: 'rgba(118, 75, 162, 1)',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: 'rgba(118, 75, 162, 1)',
                        borderWidth: 2,
                        pointRadius: 4
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    r: {
                        beginAtZero: true,
                        max: 5,
                        min: 0,
                        ticks: {
                            stepSize: 1,
                            backdropColor: 'transparent'
                        },
                        pointLabels: {
                            font: {
                                size: 11
                            },
                            color: '#333'
                        },
                        grid: {
                            color: 'rgba(0, 0, 0, 0.1)'
                        },
                        angleLines: {
                            color: 'rgba(0, 0, 0, 0.1)'
                        }
                    }
                },
                plugins: {
                    legend: {
                        position: 'top',
                        labels: {
                            font: {
                                size: 12
                            },
                            padding: 20
                        }
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return `${context.dataset.label}: ${context.raw}`;
                            }
                        }
                    }
                }
            }
        });
    }
    
    // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
    function getInitials(name) {
        if (!name) return '?';
        const parts = name.split(' ');
        if (parts.length >= 2) {
            return (parts[0][0] + parts[1][0]).toUpperCase();
        }
        return parts[0][0].toUpperCase();
    }
    
    function getRoleDisplayName(role) {
        const roles = {
            'employee': '–°–æ—Ç—Ä—É–¥–Ω–∏–∫',
            'manager': '–†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å',
            'hr': 'HR',
            'admin': '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä'
        };
        return roles[role] || role;
    }
    
    function showNotification(message, type = 'success') {
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Ñ—É–Ω–∫—Ü–∏—é –∏–ª–∏ —Å–æ–∑–¥–∞–µ–º –ø—Ä–æ—Å—Ç—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é
        if (typeof window.showSkillToast === 'function') {
            window.showSkillToast(message, type);
        } else {
            const toastId = type === 'error' ? 'errorToast' : 'successToast';
            const toast = document.getElementById(toastId);
            const messageElement = type === 'error' ? 
                document.getElementById('errorToastMessage') : 
                document.getElementById('toastMessage');
            
            if (toast && messageElement) {
                messageElement.textContent = message;
                toast.style.display = 'flex';
                
                // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫—Ä—ã–≤–∞–µ–º —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
                setTimeout(() => {
                    toast.style.display = 'none';
                }, 3000);
            } else {
                alert(message);
            }
        }
    }
    // –ó–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
    function loadAllUsers() {
        const tableBody = document.getElementById('usersTableBody');
        
        fetch('/hr/api/all-users')
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    renderUsersTable(data.users);
                } else {
                    tableBody.innerHTML = `
                        <tr>
                            <td colspan="8" style="text-align: center; padding: 2rem; color: #d32f2f;">
                                <i class="fas fa-exclamation-triangle"></i>
                                ${data.message || '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π'}
                            </td>
                        </tr>
                    `;
                }
            })
            .catch(error => {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:', error);
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="8" style="text-align: center; padding: 2rem; color: #d32f2f;">
                            <i class="fas fa-exclamation-triangle"></i>
                            –û—à–∏–±–∫–∞ —Å–µ—Ç–∏. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ.
                        </td>
                    </tr>
                `;
            });
    }

    // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ —Ç–∞–±–ª–∏—Ü–µ
    function renderUsersTable(users) {
        const tableBody = document.getElementById('usersTableBody');
        
        if (!users || users.length === 0) {
            tableBody.innerHTML = `
                <tr>
                    <td colspan="8" style="text-align: center; padding: 2rem;">
                        <i class="fas fa-users" style="font-size: 2rem; color: #ccc; margin-bottom: 1rem;"></i>
                        <div>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>
                    </td>
                </tr>
            `;
            return;
        }
        
        let html = '';
        
        users.forEach(user => {
            const createdAt = user.created_at ? new Date(user.created_at).toLocaleDateString('ru-RU') : '‚Äî';
            const departmentName = user.department || '–ù–µ —É–∫–∞–∑–∞–Ω';
            const position = user.position || '–ù–µ —É–∫–∞–∑–∞–Ω–∞';
            
            html += `
                <tr>
                    <td>${user.id}</td>
                    <td><strong>${user.full_name}</strong></td>
                    <td>${user.login}</td>
                    <td>
                        <span class="badge" style="background: ${getRoleColor(user.role)}; color: white; padding: 0.25rem 0.5rem; border-radius: 3px;">
                            ${getRoleDisplayName(user.role)}
                        </span>
                    </td>
                    <td>${position}</td>
                    <td>${departmentName}</td>
                    <td>${createdAt}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-sm btn-edit" onclick="editUser(${user.id})" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-view" onclick="viewUserProfile(${user.id})" title="–ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø—Ä–æ—Ñ–∏–ª—å">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn btn-sm btn-delete" onclick="confirmDeleteUser(${user.id}, '${user.full_name.replace(/'/g, "\\'")}')" title="–£–¥–∞–ª–∏—Ç—å">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                </tr>
            `;
        });
        
        tableBody.innerHTML = html;
    }

    // –¶–≤–µ—Ç–∞ –¥–ª—è —Ä–æ–ª–µ–π
    function getRoleColor(role) {
        const colors = {
            'admin': '#dc3545',
            'hr': '#17a2b8',
            'manager': '#28a745',
            'employee': '#6c757d'
        };
        return colors[role] || '#6c757d';
    }

    // –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
    function showEditUserModal(user) {
        console.log('–ü–æ–∫–∞–∑ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', user);
        
        const modal = document.getElementById('addUserModal');
        const title = document.getElementById('modaladduserTitle');
        const submitBtn = document.getElementById('submitBtn');
        
        // –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ñ–æ—Ä–º—ã –¥–∞–Ω–Ω—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        document.getElementById('user_id').value = user.id || '';
        document.getElementById('full_name').value = user.full_name || '';
        document.getElementById('login').value = user.login || '';
        document.getElementById('password').required = false;
        
        // –ó–∞–ø–æ–ª–Ω—è–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è –µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å
        if (document.getElementById('email')) {
            document.getElementById('email').value = user.email || '';
        }
        
        if (document.getElementById('position')) {
            document.getElementById('position').value = user.position || '';
        }
        
        if (document.getElementById('status')) {
            document.getElementById('status').value = user.status || 'active';
        }
        
        document.getElementById('role').value = user.role || '';
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º –æ—Ç–¥–µ–ª—ã –∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ
        loadDepartments().then(() => {
            setTimeout(() => {
                if (user.department_id) {
                    document.getElementById('department_id').value = user.department_id;
                }
            }, 100);
        }).catch(error => {
            console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –æ—Ç–¥–µ–ª–æ–≤:', error);
        });
        
        // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≥–æ–ª–æ–≤–∫–∞ –∏ —Ç–µ–∫—Å—Ç–∞ –∫–Ω–æ–ø–∫–∏
        title.textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è';
        submitBtn.textContent = '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è';
        submitBtn.className = 'btn btn-primary';
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
        modal.style.display = 'block';
        
        // –§–æ–∫—É—Å –Ω–∞ –ø–µ—Ä–≤–æ–º –ø–æ–ª–µ
        setTimeout(() => {
            document.getElementById('full_name').focus();
        }, 100);
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ø—Ä–æ—Ñ–∏–ª—è
    function viewUserProfile(userId) {
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π endpoint –∏–∑ user_routes.py
        // endpoint: /user/employee/<int:user_id>
        window.open(`/user/employee/${userId}`, '_blank');
    
        // –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ, –µ—Å–ª–∏ endpoint –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:
        // window.open(`/employee/${userId}`, '_blank');
        
        // –ò–ª–∏ –¥–ª—è —Ç–µ—Å—Ç–∞ –æ—Ç–∫—Ä–æ–π—Ç–µ –≤ —ç—Ç–æ–π –∂–µ –≤–∫–ª–∞–¥–∫–µ:
        // window.location.href = `/user/employee/${userId}`;
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    function editUser(userId, event) {
        if (event) event.stopPropagation();
    
        console.log(`–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ID: ${userId}`);
        
        fetch(`/hr/api/users/${userId}`)
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                console.log('–î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å —Å–µ—Ä–≤–µ—Ä–∞:', data);
                if (data.success) {
                    showEditUserModal(data.user);
                } else {
                    showNotification(data.message || '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö', 'error');
                }
            })
            .catch(error => {
                console.error('Error loading user:', error);
                showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞.', 'error');
            });
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —É–¥–∞–ª–µ–Ω–∏—è
    function confirmDeleteUser(userId, userName) {
        currentUserToDelete = userId;
        const modal = document.getElementById('deleteUserModal');
        const message = document.getElementById('deleteUserMessage');
        
        message.textContent = `–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è "${userName}"?`;
        modal.style.display = 'block';
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    document.addEventListener('DOMContentLoaded', function() {
        // –ó–∞–≥—Ä—É–∂–∞–µ–º –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        loadAllUsers();
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
        window.refreshUserList = function() {
            loadAllUsers();
        };
    });
    
</script>
{% endblock %}